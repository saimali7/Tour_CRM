# Booking System Architecture

**Version:** 2.0
**Created:** December 2025
**Status:** Design Complete, Implementation Pending

> A customer-first booking system designed from first principles. The customer tells us WHO and WHEN, then we show them all their options with personalized pricing.

---

## Table of Contents

1. [Design Philosophy](#design-philosophy)
2. [The Customer-First Flow](#the-customer-first-flow)
3. [Booking Options (Operator Configuration)](#booking-options-operator-configuration)
4. [Pricing Models](#pricing-models)
5. [Capacity Models](#capacity-models)
6. [Add-Ons System](#add-ons-system)
7. [Smart Recommendations](#smart-recommendations)
8. [Database Schema](#database-schema)
9. [API Design](#api-design)
10. [TypeScript Interfaces](#typescript-interfaces)
11. [UI/UX Patterns](#uiux-patterns)
12. [Real-World Examples](#real-world-examples)
13. [Implementation Plan](#implementation-plan)

---

## Design Philosophy

### Think Like the Customer

When someone wants to book a tour, they think:

1. **"I want to do this tour"** â€” They're already on the page
2. **"We're 4 people"** â€” They know their group
3. **"We want to go Saturday"** â€” They know when
4. **"What are my options?"** â€” NOW show them choices

They do NOT think:
- "I want per-unit pricing"
- "Let me pick the shared option first"
- "How does flat-rate work?"

### The Old Way (Wrong)

```
Step 1: Pick an option (Shared/Private/VIP)    â† Customer doesn't know yet!
Step 2: Enter number of people                  â† Now they configure
Step 3: See the price                           â† Finally...
```

**Problems:**
- Customer must understand options before knowing their group fits
- Prices shown as "from $89" are meaningless
- No easy comparison between options
- Options that don't fit their group are still shown

### The New Way (Right)

```
Step 1: Enter date and guests                   â† Simple, universal
Step 2: See ALL options with YOUR prices        â† Personalized, comparable
Step 3: Pick the best one for you               â† Informed decision
```

**Benefits:**
- Prices shown are REAL prices for THEIR group
- Options that don't work are filtered out
- Easy side-by-side comparison
- Smart recommendations ("Only $31 more for private!")

---

## The Customer-First Flow

### Overview

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        CUSTOMER BOOKING FLOW                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚  STEP 1: WHO & WHEN                                                 â”‚   â”‚
â”‚   â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚   â”‚
â”‚   â”‚  "When do you want to go?"     â†’  ðŸ“… December 25, 2025              â”‚   â”‚
â”‚   â”‚  "Who's coming?"               â†’  2 Adults, 1 Child                 â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                       â”‚                                      â”‚
â”‚                                       â–¼                                      â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚  STEP 2: SEE YOUR OPTIONS (personalized)                            â”‚   â”‚
â”‚   â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚   â”‚
â”‚   â”‚                                                                      â”‚   â”‚
â”‚   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚   â”‚
â”‚   â”‚  â”‚  SHARED SAFARI   â”‚ â”‚ PRIVATE VEHICLE  â”‚ â”‚   VIP PRIVATE    â”‚    â”‚   â”‚
â”‚   â”‚  â”‚                  â”‚ â”‚   â­ BEST VALUE   â”‚ â”‚                  â”‚    â”‚   â”‚
â”‚   â”‚  â”‚  $223 total      â”‚ â”‚  $299 total      â”‚ â”‚  $499 total      â”‚    â”‚   â”‚
â”‚   â”‚  â”‚  2Ã—$89 + 1Ã—$45   â”‚ â”‚  Only $76 more!  â”‚ â”‚  Luxury SUV      â”‚    â”‚   â”‚
â”‚   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚   â”‚
â”‚   â”‚                                                                      â”‚   â”‚
â”‚   â”‚  âœ— Options that don't fit are hidden                                â”‚   â”‚
â”‚   â”‚  âœ“ Prices calculated for YOUR group                                 â”‚   â”‚
â”‚   â”‚  âœ“ Smart recommendations highlight best value                       â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                       â”‚                                      â”‚
â”‚                                       â–¼                                      â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚  STEP 3: SELECT TIME (if applicable)                                â”‚   â”‚
â”‚   â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚   â”‚
â”‚   â”‚  Shared: Pick from available time slots                             â”‚   â”‚
â”‚   â”‚  Private: Choose preferred departure time                           â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                       â”‚                                      â”‚
â”‚                                       â–¼                                      â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚  STEP 4: ADD-ONS (calculated for your group)                        â”‚   â”‚
â”‚   â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚   â”‚
â”‚   â”‚  â˜ BBQ Dinner          $35 Ã— 3 guests = $105                       â”‚   â”‚
â”‚   â”‚  â˜ Photo Package       $25 per booking                              â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                       â”‚                                      â”‚
â”‚                                       â–¼                                      â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚  STEP 5: CHECKOUT                                                   â”‚   â”‚
â”‚   â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚   â”‚
â”‚   â”‚  Summary â†’ Payment â†’ Confirmation                                   â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Step 1: Who & When (The Universal Input)

Every booking starts with the same two questions:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                              â”‚
â”‚  Desert Safari Experience                                                    â”‚
â”‚  â­ 4.9 (2,847 reviews) Â· 4 hours Â· Pickup included                          â”‚
â”‚                                                                              â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•   â”‚
â”‚                                                                              â”‚
â”‚  When do you want to go?                                                     â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                                                                        â”‚  â”‚
â”‚  â”‚   â—€  December 2025  â–¶                                                 â”‚  â”‚
â”‚  â”‚                                                                        â”‚  â”‚
â”‚  â”‚   Su    Mo    Tu    We    Th    Fr    Sa                              â”‚  â”‚
â”‚  â”‚                                                                        â”‚  â”‚
â”‚  â”‚   14    15    16    17    18    19    20                              â”‚  â”‚
â”‚  â”‚                                                                        â”‚  â”‚
â”‚  â”‚   21    22    23    24   [25]   26    27                              â”‚  â”‚
â”‚  â”‚                           â”€â”€â”€                                          â”‚  â”‚
â”‚  â”‚   28    29    30    31                                                â”‚  â”‚
â”‚  â”‚                                                                        â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                              â”‚
â”‚  Who's coming?                                                               â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                                                                        â”‚  â”‚
â”‚  â”‚   Adults (13+)                    [ âˆ’ ]      2      [ + ]             â”‚  â”‚
â”‚  â”‚                                                                        â”‚  â”‚
â”‚  â”‚   Children (5-12)                 [ âˆ’ ]      1      [ + ]             â”‚  â”‚
â”‚  â”‚                                                                        â”‚  â”‚
â”‚  â”‚   Infants (0-4)                   [ âˆ’ ]      0      [ + ]      Free   â”‚  â”‚
â”‚  â”‚                                                                        â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                                                                        â”‚  â”‚
â”‚  â”‚                       [ Check Availability ]                           â”‚  â”‚
â”‚  â”‚                                                                        â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Step 2: See All Options (Personalized)

Based on their input, show ALL viable options with calculated prices:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                              â”‚
â”‚  Thursday, December 25 Â· 3 guests (2 adults, 1 child)          [ â† Change ] â”‚
â”‚                                                                              â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•   â”‚
â”‚                                                                              â”‚
â”‚  Choose your experience                                                      â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                                                                        â”‚  â”‚
â”‚  â”‚   SHARED SAFARI                                                        â”‚  â”‚
â”‚  â”‚   Join other travelers on a group adventure                            â”‚  â”‚
â”‚  â”‚                                                                        â”‚  â”‚
â”‚  â”‚   Select a time:                                                       â”‚  â”‚
â”‚  â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚  â”‚
â”‚  â”‚   â”‚ 10:00 AM â”‚  â”‚  2:00 PM â”‚  â”‚  4:00 PM â”‚  â”‚  6:00 PM â”‚             â”‚  â”‚
â”‚  â”‚   â”‚ 8 spots  â”‚  â”‚ 3 spots  â”‚  â”‚ 12 spots â”‚  â”‚ 6 spots  â”‚             â”‚  â”‚
â”‚  â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚  â”‚
â”‚  â”‚                                                                        â”‚  â”‚
â”‚  â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚   â”‚  $223 total                    2 Ã— Adult ($89) + 1 Ã— Child ($45)â”‚  â”‚  â”‚
â”‚  â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â”‚                                                       [ Select â†’ ]    â”‚  â”‚
â”‚  â”‚                                                                        â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                                                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚
â”‚  â”‚   PRIVATE VEHICLE                                    â”‚  BEST VALUE  â”‚ â”‚  â”‚
â”‚  â”‚   Your own 4x4 with dedicated driver                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚
â”‚  â”‚                                                                        â”‚  â”‚
â”‚  â”‚   Depart anytime between 8:00 AM - 5:00 PM                            â”‚  â”‚
â”‚  â”‚   1 vehicle Â· Fits up to 4 people âœ“                                   â”‚  â”‚
â”‚  â”‚                                                                        â”‚  â”‚
â”‚  â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚   â”‚  $299 total              Only $76 more than shared for privacy â”‚  â”‚  â”‚
â”‚  â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â”‚                                                       [ Select â†’ ]    â”‚  â”‚
â”‚  â”‚                                                                        â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                                                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚
â”‚  â”‚   VIP PRIVATE                                        â”‚    LUXURY    â”‚ â”‚  â”‚
â”‚  â”‚   Premium SUV Â· Champagne Â· Gourmet snacks           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚
â”‚  â”‚                                                                        â”‚  â”‚
â”‚  â”‚   Depart anytime Â· Priority pickup Â· Refreshments included            â”‚  â”‚
â”‚  â”‚   1 luxury SUV Â· Fits up to 4 people âœ“                                â”‚  â”‚
â”‚  â”‚                                                                        â”‚  â”‚
â”‚  â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚   â”‚  $499 total                        The ultimate desert experienceâ”‚  â”‚  â”‚
â”‚  â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â”‚                                                       [ Select â†’ ]    â”‚  â”‚
â”‚  â”‚                                                                        â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                                                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚
â”‚  â”‚   SAFARI + DINNER COMBO                              â”‚   SAVE $40   â”‚ â”‚  â”‚
â”‚  â”‚   Shared safari + BBQ dinner under the stars         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚
â”‚  â”‚                                                                        â”‚  â”‚
â”‚  â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚   â”‚  $288 total                           Includes $105 dinner free â”‚  â”‚  â”‚
â”‚  â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â”‚                                                       [ Select â†’ ]    â”‚  â”‚
â”‚  â”‚                                                                        â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Dynamic Personalization Examples

The same tour page shows different options based on group composition:

#### Solo Traveler (1 adult)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Wednesday, December 25 Â· 1 guest                              [ â† Change ] â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•   â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  SHARED SAFARI                                          RECOMMENDED   â”‚  â”‚
â”‚  â”‚  Meet fellow travelers on a group adventure                           â”‚  â”‚
â”‚  â”‚                                                                        â”‚  â”‚
â”‚  â”‚  $89 total                                                            â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  PRIVATE VEHICLE                                                       â”‚  â”‚
â”‚  â”‚  Your own 4x4 - great if you prefer solitude                          â”‚  â”‚
â”‚  â”‚                                                                        â”‚  â”‚
â”‚  â”‚  $299 total                                                            â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### Family of 4 (2 adults, 2 children)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Wednesday, December 25 Â· 4 guests (2 adults, 2 children)      [ â† Change ] â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•   â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  SHARED SAFARI                                                         â”‚  â”‚
â”‚  â”‚  Join other travelers on a group adventure                             â”‚  â”‚
â”‚  â”‚                                                                        â”‚  â”‚
â”‚  â”‚  $268 total                           2 Ã— $89 + 2 Ã— $45               â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  PRIVATE VEHICLE                                â­ BEST FOR FAMILIES   â”‚  â”‚
â”‚  â”‚  Your own vehicle - perfect for families with kids                    â”‚  â”‚
â”‚  â”‚  1 vehicle Â· Fits your family perfectly                               â”‚  â”‚
â”‚  â”‚                                                                        â”‚  â”‚
â”‚  â”‚  $299 total                    Only $31 more for complete privacy!    â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### Large Group (8 adults)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Wednesday, December 25 Â· 8 guests                             [ â† Change ] â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•   â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  SHARED SAFARI                                                         â”‚  â”‚
â”‚  â”‚  Your group joins a shared tour                                        â”‚  â”‚
â”‚  â”‚                                                                        â”‚  â”‚
â”‚  â”‚  $712 total                                              8 Ã— $89      â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  2 PRIVATE VEHICLES                                 â­ BEST FOR YOU    â”‚  â”‚
â”‚  â”‚  Your group gets 2 dedicated 4x4s                                     â”‚  â”‚
â”‚  â”‚  2 vehicles Â· 4 people each                                           â”‚  â”‚
â”‚  â”‚                                                                        â”‚  â”‚
â”‚  â”‚  $598 total                           Save $114 vs shared!            â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  PRIVATE MINIBUS                                                       â”‚  â”‚
â”‚  â”‚  Everyone together in one vehicle                                      â”‚  â”‚
â”‚  â”‚  1 minibus Â· Fits up to 12                                            â”‚  â”‚
â”‚  â”‚                                                                        â”‚  â”‚
â”‚  â”‚  $550 total                           All together, great for groups  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                              â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚  âœ— Single Private Vehicle hidden (only fits 4, your group has 8)          â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Booking Options (Operator Configuration)

While customers see personalized results, operators configure the underlying options.

### Booking Option Entity

```typescript
interface BookingOption {
  id: string;
  organizationId: string;
  tourId: string;

  // Identity
  name: string;                      // "Shared Safari", "Private Vehicle"
  shortDescription: string;          // One-liner for cards
  fullDescription?: string;          // Detailed description

  // Badges & Marketing
  badge?: string;                    // "LUXURY", "MOST POPULAR"
  highlightText?: string;            // "Recommended for families"

  // The Core Configuration
  pricingModel: PricingModel;        // How to calculate price
  capacityModel: CapacityModel;      // How to track availability

  // Scheduling
  schedulingType: 'fixed' | 'flexible';
  // fixed: Customer picks from available time slots
  // flexible: Customer can depart within a time range

  // Display
  isDefault: boolean;
  sortOrder: number;
  status: 'active' | 'inactive';

  // Metadata
  createdAt: Date;
  updatedAt: Date;
}
```

### Experience Modes (Simplified Customer View)

While operators configure complex pricing models, customers see simple modes:

| Mode | Customer Sees | Examples |
|------|---------------|----------|
| **Join** | "Join others" | Shared tours, group experiences |
| **Book** | "Book for your group" | Private vehicles, exclusive access |
| **Charter** | "The whole thing is yours" | Full boat charter, venue buyout |

```typescript
type ExperienceMode = 'join' | 'book' | 'charter';

// Derived from pricing/capacity model
function getExperienceMode(option: BookingOption): ExperienceMode {
  if (option.capacityModel.type === 'shared') return 'join';
  if (option.pricingModel.type === 'flat_rate') return 'charter';
  return 'book';
}
```

---

## Pricing Models

Five pricing models cover all real-world scenarios. The key is that prices are **calculated based on customer input**, not shown as static values.

### 1. Per Person (`per_person`)

Shared tours where each participant pays based on their tier.

```typescript
interface PerPersonPricing {
  type: 'per_person';
  tiers: PricingTier[];
}

interface PricingTier {
  id: string;
  name: string;              // "Adult", "Child", "Senior"
  price: Money;
  ageMin?: number;
  ageMax?: number;
  isDefault: boolean;
  sortOrder: number;
}
```

**Calculation:**
```typescript
function calculatePerPerson(pricing: PerPersonPricing, guests: GuestBreakdown): Money {
  const adultTier = pricing.tiers.find(t => t.id === 'adult');
  const childTier = pricing.tiers.find(t => t.id === 'child');

  let total = 0;
  total += (adultTier?.price.amount ?? 0) * guests.adults;
  total += (childTier?.price.amount ?? 0) * guests.children;
  // Infants typically free

  return { amount: total, currency: 'USD' };
}

// Example: 2 adults ($89 each) + 1 child ($45) = $223
```

---

### 2. Per Unit (`per_unit`)

Private vehicles, boats, or equipment with occupancy limits.

```typescript
interface PerUnitPricing {
  type: 'per_unit';
  unitName: string;          // "Vehicle", "Boat"
  unitNamePlural: string;
  pricePerUnit: Money;
  maxOccupancy: number;
  minOccupancy?: number;

  // Optional: Extra person fees
  baseOccupancy?: number;
  extraPersonFee?: Money;
}
```

**Calculation:**
```typescript
function calculatePerUnit(pricing: PerUnitPricing, guests: GuestBreakdown): CalculatedPrice {
  const totalGuests = guests.adults + guests.children + guests.infants;
  const unitsNeeded = Math.ceil(totalGuests / pricing.maxOccupancy);

  let total = pricing.pricePerUnit.amount * unitsNeeded;

  // Extra person fees if applicable
  if (pricing.baseOccupancy && pricing.extraPersonFee) {
    const includedGuests = pricing.baseOccupancy * unitsNeeded;
    const extraGuests = Math.max(0, totalGuests - includedGuests);
    total += pricing.extraPersonFee.amount * extraGuests;
  }

  return {
    total: { amount: total, currency: 'USD' },
    unitsNeeded,
    breakdown: `${unitsNeeded} Ã— ${pricing.unitName} ($${pricing.pricePerUnit.amount / 100})`,
  };
}

// Example: 3 guests, max 4 per vehicle, $299/vehicle = $299 (1 vehicle)
// Example: 6 guests, max 4 per vehicle, $299/vehicle = $598 (2 vehicles)
```

---

### 3. Flat Rate (`flat_rate`)

Fixed price regardless of group size (up to maximum).

```typescript
interface FlatRatePricing {
  type: 'flat_rate';
  price: Money;
  maxParticipants: number;
  minParticipants?: number;
}
```

**Calculation:**
```typescript
function calculateFlatRate(pricing: FlatRatePricing, guests: GuestBreakdown): CalculatedPrice | null {
  const totalGuests = guests.adults + guests.children + guests.infants;

  if (totalGuests > pricing.maxParticipants) {
    return null; // Option not available for this group size
  }

  if (pricing.minParticipants && totalGuests < pricing.minParticipants) {
    return null;
  }

  return {
    total: pricing.price,
    breakdown: `Flat rate for up to ${pricing.maxParticipants} people`,
  };
}

// Example: 4 guests, flat rate $600 (up to 6) = $600
```

---

### 4. Tiered Group (`tiered_group`)

Different prices for different group size ranges.

```typescript
interface TieredGroupPricing {
  type: 'tiered_group';
  tiers: GroupTier[];
}

interface GroupTier {
  minSize: number;
  maxSize: number;
  price: Money;
}
```

**Calculation:**
```typescript
function calculateTieredGroup(pricing: TieredGroupPricing, guests: GuestBreakdown): CalculatedPrice | null {
  const totalGuests = guests.adults + guests.children;

  const tier = pricing.tiers.find(t =>
    totalGuests >= t.minSize && totalGuests <= t.maxSize
  );

  if (!tier) return null; // No tier fits this group

  return {
    total: tier.price,
    breakdown: `Group rate for ${tier.minSize}-${tier.maxSize} people`,
  };
}

// Example: 8 guests, tier "7-10 people: $850" = $850
```

---

### 5. Base Plus Person (`base_plus_person`)

Base fee includes some participants, additional fee for extras.

```typescript
interface BasePerPersonPricing {
  type: 'base_plus_person';
  basePrice: Money;
  includedParticipants: number;
  perPersonPrice: Money;
  maxParticipants: number;
}
```

**Calculation:**
```typescript
function calculateBasePlusPerson(pricing: BasePerPersonPricing, guests: GuestBreakdown): CalculatedPrice | null {
  const totalGuests = guests.adults + guests.children;

  if (totalGuests > pricing.maxParticipants) return null;

  let total = pricing.basePrice.amount;
  const extraGuests = Math.max(0, totalGuests - pricing.includedParticipants);
  total += pricing.perPersonPrice.amount * extraGuests;

  return {
    total: { amount: total, currency: 'USD' },
    breakdown: extraGuests > 0
      ? `Base (${pricing.includedParticipants} people) + ${extraGuests} Ã— $${pricing.perPersonPrice.amount / 100}`
      : `Base price (includes up to ${pricing.includedParticipants} people)`,
  };
}

// Example: 6 guests, base $150 (includes 4), extra $25/person
// = $150 + (2 Ã— $25) = $200
```

---

## Capacity Models

### Shared Capacity

A pool of seats shared across bookings.

```typescript
interface SharedCapacity {
  type: 'shared';
  totalSeats: number;
}
```

**Availability Check:**
```typescript
function checkSharedAvailability(
  capacity: SharedCapacity,
  schedule: Schedule,
  guests: GuestBreakdown
): AvailabilityResult {
  const totalGuests = guests.adults + guests.children + guests.infants;
  const available = capacity.totalSeats - schedule.bookedSeats;

  return {
    available: totalGuests <= available,
    spotsLeft: available,
    message: available < 5 ? `Only ${available} spots left!` : undefined,
  };
}
```

### Unit Capacity

Discrete units (vehicles, boats) booked exclusively.

```typescript
interface UnitCapacity {
  type: 'unit';
  totalUnits: number;
  occupancyPerUnit: number;
}
```

**Availability Check:**
```typescript
function checkUnitAvailability(
  capacity: UnitCapacity,
  schedule: Schedule,
  guests: GuestBreakdown
): AvailabilityResult {
  const totalGuests = guests.adults + guests.children + guests.infants;
  const unitsNeeded = Math.ceil(totalGuests / capacity.occupancyPerUnit);
  const unitsAvailable = capacity.totalUnits - schedule.bookedUnits;

  return {
    available: unitsNeeded <= unitsAvailable,
    unitsNeeded,
    unitsAvailable,
    fitsInOneUnit: totalGuests <= capacity.occupancyPerUnit,
    message: unitsNeeded > 1 ? `Requires ${unitsNeeded} ${capacity.unitNamePlural}` : undefined,
  };
}
```

---

## Add-Ons System

Add-ons enhance any booking and are also calculated based on guest count.

### Add-On Definition

```typescript
interface TourAddOn {
  id: string;
  tourId: string;
  organizationId: string;

  name: string;
  description?: string;
  imageUrl?: string;

  // Pricing - calculated per guest breakdown
  pricingStructure: AddOnPricing;

  // Quantity
  allowQuantity: boolean;
  maxQuantity?: number;

  // Inventory
  hasInventory: boolean;
  inventoryPerSchedule?: number;

  // Which options this applies to
  applicableOptions: string[] | 'all';

  // Requirements
  isRequired: boolean;
  deadlineHours?: number;        // Must select X hours before

  // Dependencies
  requires?: string[];           // Must select these add-ons first
  excludes?: string[];           // Can't combine with these
  includedIn?: string[];         // Auto-included in these options

  sortOrder: number;
  status: 'active' | 'inactive';
}

type AddOnPricing =
  | { type: 'fixed'; price: Money }
  | { type: 'per_person'; pricePerPerson: Money }
  | { type: 'per_adult'; pricePerAdult: Money }
  | { type: 'per_participant'; tiers: { name: string; price: Money; ageMin?: number; ageMax?: number }[] }
  | { type: 'per_booking'; price: Money }
  | { type: 'per_unit'; pricePerUnit: Money };
```

### Add-On Calculation

```typescript
function calculateAddOnPrice(
  addOn: TourAddOn,
  guests: GuestBreakdown,
  unitsBooked?: number
): Money {
  const pricing = addOn.pricingStructure;

  switch (pricing.type) {
    case 'fixed':
    case 'per_booking':
      return pricing.price;

    case 'per_person':
      const total = guests.adults + guests.children;
      return { amount: pricing.pricePerPerson.amount * total, currency: 'USD' };

    case 'per_adult':
      return { amount: pricing.pricePerAdult.amount * guests.adults, currency: 'USD' };

    case 'per_participant':
      let sum = 0;
      for (const tier of pricing.tiers) {
        if (tier.name === 'Adult') sum += tier.price.amount * guests.adults;
        if (tier.name === 'Child') sum += tier.price.amount * guests.children;
      }
      return { amount: sum, currency: 'USD' };

    case 'per_unit':
      return { amount: pricing.pricePerUnit.amount * (unitsBooked ?? 1), currency: 'USD' };
  }
}
```

---

## Smart Recommendations

The system intelligently recommends options based on group composition.

### Recommendation Engine

```typescript
interface Recommendation {
  optionId: string;
  badge?: 'BEST_VALUE' | 'RECOMMENDED' | 'BEST_FOR_FAMILIES' | 'LUXURY';
  reason: string;
  comparisonToShared?: {
    difference: Money;
    percentMore: number;
    statement: string;
  };
}

function generateRecommendations(
  options: CalculatedOption[],
  guests: GuestBreakdown
): Recommendation[] {
  const recommendations: Recommendation[] = [];
  const totalGuests = guests.adults + guests.children;

  const sharedOption = options.find(o => o.experienceMode === 'join');
  const privateOptions = options.filter(o => o.experienceMode === 'book');

  for (const option of privateOptions) {
    if (!sharedOption) continue;

    const diff = option.totalPrice.amount - sharedOption.totalPrice.amount;
    const percentMore = (diff / sharedOption.totalPrice.amount) * 100;

    // Rule 1: If private is <25% more than shared, it's BEST VALUE
    if (percentMore > 0 && percentMore < 25) {
      recommendations.push({
        optionId: option.id,
        badge: 'BEST_VALUE',
        reason: `Only $${(diff / 100).toFixed(0)} more for complete privacy`,
        comparisonToShared: {
          difference: { amount: diff, currency: 'USD' },
          percentMore,
          statement: `Only ${percentMore.toFixed(0)}% more than shared`,
        },
      });
    }

    // Rule 2: If private is CHEAPER than shared (large groups), highlight savings
    if (diff < 0) {
      recommendations.push({
        optionId: option.id,
        badge: 'BEST_VALUE',
        reason: `Save $${(Math.abs(diff) / 100).toFixed(0)} vs shared!`,
      });
    }

    // Rule 3: Families with children might prefer private
    if (guests.children > 0 && option.capacityFit?.fitsInOneUnit) {
      recommendations.push({
        optionId: option.id,
        badge: 'BEST_FOR_FAMILIES',
        reason: 'Private experience recommended for families',
      });
    }
  }

  // Rule 4: If group exactly fills a unit, highlight perfect fit
  for (const option of privateOptions) {
    if (option.capacityFit?.fitsInOneUnit && option.capacityFit?.unitsNeeded === 1) {
      const occupancy = option.capacityModel.occupancyPerUnit;
      if (totalGuests >= occupancy * 0.75) {
        recommendations.push({
          optionId: option.id,
          badge: 'RECOMMENDED',
          reason: 'Perfect fit for your group size',
        });
      }
    }
  }

  return recommendations;
}
```

---

## Database Schema

### Core Tables

```sql
-- ============================================================
-- BOOKING OPTIONS
-- ============================================================

CREATE TABLE booking_options (
  id TEXT PRIMARY KEY DEFAULT gen_random_uuid(),
  organization_id TEXT NOT NULL REFERENCES organizations(id),
  tour_id TEXT NOT NULL REFERENCES tours(id),

  -- Identity
  name TEXT NOT NULL,
  short_description TEXT,
  full_description TEXT,

  -- Badges & Marketing
  badge TEXT,
  highlight_text TEXT,

  -- Configuration (JSONB for flexibility)
  pricing_model JSONB NOT NULL,
  capacity_model JSONB NOT NULL,

  -- Scheduling
  scheduling_type TEXT DEFAULT 'fixed' CHECK (scheduling_type IN ('fixed', 'flexible')),

  -- Display
  is_default BOOLEAN DEFAULT false,
  sort_order INTEGER DEFAULT 0,
  status TEXT DEFAULT 'active' CHECK (status IN ('active', 'inactive')),

  -- Timestamps
  created_at TIMESTAMPTZ DEFAULT NOW(),
  updated_at TIMESTAMPTZ DEFAULT NOW(),

  -- Constraints
  UNIQUE (tour_id, name)
);

CREATE INDEX idx_booking_options_tour ON booking_options(tour_id);
CREATE INDEX idx_booking_options_org_status ON booking_options(organization_id, status);

-- ============================================================
-- TOUR ADD-ONS
-- ============================================================

CREATE TABLE tour_add_ons (
  id TEXT PRIMARY KEY DEFAULT gen_random_uuid(),
  organization_id TEXT NOT NULL REFERENCES organizations(id),
  tour_id TEXT NOT NULL REFERENCES tours(id),

  -- Identity
  name TEXT NOT NULL,
  description TEXT,
  image_url TEXT,

  -- Pricing (JSONB for flexible structures)
  pricing_structure JSONB NOT NULL,

  -- Quantity
  allow_quantity BOOLEAN DEFAULT false,
  max_quantity INTEGER,

  -- Inventory
  has_inventory BOOLEAN DEFAULT false,
  inventory_per_schedule INTEGER,

  -- Applicability
  applicable_options JSONB,          -- ["option-id-1", ...] or null for all

  -- Requirements
  is_required BOOLEAN DEFAULT false,
  deadline_hours INTEGER,

  -- Dependencies
  requires JSONB,                    -- Add-on IDs that must be selected first
  excludes JSONB,                    -- Add-on IDs that can't be combined
  included_in JSONB,                 -- Option IDs where this is auto-included

  -- Display
  sort_order INTEGER DEFAULT 0,
  status TEXT DEFAULT 'active' CHECK (status IN ('active', 'inactive')),

  created_at TIMESTAMPTZ DEFAULT NOW(),
  updated_at TIMESTAMPTZ DEFAULT NOW()
);

CREATE INDEX idx_tour_add_ons_tour ON tour_add_ons(tour_id);

-- ============================================================
-- SCHEDULE OPTION AVAILABILITY
-- ============================================================

CREATE TABLE schedule_option_availability (
  id TEXT PRIMARY KEY DEFAULT gen_random_uuid(),
  schedule_id TEXT NOT NULL REFERENCES schedules(id) ON DELETE CASCADE,
  booking_option_id TEXT NOT NULL REFERENCES booking_options(id) ON DELETE CASCADE,

  -- Shared capacity
  total_seats INTEGER,
  booked_seats INTEGER DEFAULT 0,

  -- Unit capacity
  total_units INTEGER,
  booked_units INTEGER DEFAULT 0,

  UNIQUE (schedule_id, booking_option_id)
);

CREATE INDEX idx_schedule_availability_schedule ON schedule_option_availability(schedule_id);

-- ============================================================
-- SCHEDULE ADD-ON INVENTORY
-- ============================================================

CREATE TABLE schedule_add_on_inventory (
  id TEXT PRIMARY KEY DEFAULT gen_random_uuid(),
  schedule_id TEXT NOT NULL REFERENCES schedules(id) ON DELETE CASCADE,
  add_on_id TEXT NOT NULL REFERENCES tour_add_ons(id) ON DELETE CASCADE,

  total_inventory INTEGER NOT NULL,
  booked_inventory INTEGER DEFAULT 0,

  UNIQUE (schedule_id, add_on_id)
);

-- ============================================================
-- BOOKING ADD-ONS (Snapshot)
-- ============================================================

CREATE TABLE booking_add_ons (
  id TEXT PRIMARY KEY DEFAULT gen_random_uuid(),
  booking_id TEXT NOT NULL REFERENCES bookings(id) ON DELETE CASCADE,
  add_on_id TEXT NOT NULL REFERENCES tour_add_ons(id),

  -- Snapshot (immutable after booking)
  name TEXT NOT NULL,
  quantity INTEGER NOT NULL DEFAULT 1,
  unit_price_amount INTEGER NOT NULL,
  unit_price_currency TEXT NOT NULL,
  total_price_amount INTEGER NOT NULL,
  total_price_currency TEXT NOT NULL,

  created_at TIMESTAMPTZ DEFAULT NOW()
);

CREATE INDEX idx_booking_add_ons_booking ON booking_add_ons(booking_id);

-- ============================================================
-- WAITLIST
-- ============================================================

CREATE TABLE waitlist_entries (
  id TEXT PRIMARY KEY DEFAULT gen_random_uuid(),
  organization_id TEXT NOT NULL,
  schedule_id TEXT NOT NULL REFERENCES schedules(id) ON DELETE CASCADE,
  booking_option_id TEXT REFERENCES booking_options(id),

  -- Contact
  customer_id TEXT REFERENCES customers(id),
  email TEXT NOT NULL,
  phone TEXT,

  -- Request
  adults INTEGER NOT NULL,
  children INTEGER DEFAULT 0,
  infants INTEGER DEFAULT 0,

  -- Status
  status TEXT DEFAULT 'waiting' CHECK (status IN ('waiting', 'notified', 'converted', 'expired')),
  notified_at TIMESTAMPTZ,
  expires_at TIMESTAMPTZ,

  created_at TIMESTAMPTZ DEFAULT NOW()
);

CREATE INDEX idx_waitlist_schedule ON waitlist_entries(schedule_id, status);

-- ============================================================
-- UPDATE BOOKINGS TABLE
-- ============================================================

ALTER TABLE bookings
  ADD COLUMN booking_option_id TEXT REFERENCES booking_options(id),
  ADD COLUMN units_booked INTEGER,
  ADD COLUMN unit_occupants INTEGER,
  ADD COLUMN guest_adults INTEGER,
  ADD COLUMN guest_children INTEGER,
  ADD COLUMN guest_infants INTEGER;

CREATE INDEX idx_bookings_option ON bookings(booking_option_id);
```

---

## API Design

### The Core Query: Check Availability

This is the heart of the customer-first flow. Given a date and guests, return all options with calculated prices.

```typescript
// Request
interface CheckAvailabilityRequest {
  tourId: string;
  date: string;                      // ISO date
  guests: {
    adults: number;
    children: number;
    infants: number;
  };
}

// Response
interface CheckAvailabilityResponse {
  tour: {
    id: string;
    name: string;
    imageUrl: string;
  };

  date: string;
  guests: {
    adults: number;
    children: number;
    infants: number;
    total: number;
  };

  // All viable options with calculated prices
  options: CalculatedOption[];

  // If no options available
  soldOut: boolean;

  // Alternatives if requested date is problematic
  alternatives?: {
    nearbyDates?: Array<{ date: string; availability: 'available' | 'limited' }>;
    waitlistAvailable?: boolean;
  };
}

interface CalculatedOption {
  // Identity
  id: string;
  name: string;
  shortDescription: string;
  experienceMode: 'join' | 'book' | 'charter';

  // THE KEY: Pre-calculated price for THIS group
  totalPrice: Money;
  priceBreakdown: string;            // "2 Ã— $89 + 1 Ã— $45"

  // Comparison to help decision-making
  comparison?: {
    vsShared: {
      difference: Money;
      percentMore: number;
      statement: string;             // "Only $76 more for privacy"
    };
  };

  // Recommendations
  badge?: 'BEST_VALUE' | 'RECOMMENDED' | 'LUXURY' | 'SAVE_MONEY';
  recommendation?: string;           // "Perfect for families"

  // Scheduling
  scheduling: SchedulingInfo;

  // Capacity fit
  capacityFit: {
    fits: boolean;
    unitsNeeded?: number;
    fitsInOneUnit?: boolean;
    statement?: string;              // "Requires 2 vehicles"
  };

  // Availability
  available: boolean;
  urgency?: string;                  // "Only 2 spots left!"
}

type SchedulingInfo =
  | {
      type: 'fixed';
      timeSlots: Array<{
        time: string;                // "10:00 AM"
        available: boolean;
        spotsLeft?: number;
        almostFull: boolean;
      }>;
    }
  | {
      type: 'flexible';
      earliestDeparture: string;
      latestDeparture: string;
      suggestedTime?: string;
    };
```

### tRPC Router

```typescript
export const availabilityRouter = router({

  // Main query: Get options for date + guests
  checkAvailability: publicProcedure
    .input(z.object({
      tourId: z.string(),
      date: z.string(),
      guests: z.object({
        adults: z.number().min(1),
        children: z.number().min(0),
        infants: z.number().min(0),
      }),
    }))
    .query(async ({ input }) => {
      return availabilityService.checkAvailability(input);
    }),

  // Get add-ons for selected option
  getAddOns: publicProcedure
    .input(z.object({
      tourId: z.string(),
      optionId: z.string(),
      scheduleId: z.string(),
      guests: z.object({
        adults: z.number(),
        children: z.number(),
        infants: z.number(),
      }),
    }))
    .query(async ({ input }) => {
      return addOnService.getCalculatedAddOns(input);
    }),

  // Join waitlist
  joinWaitlist: publicProcedure
    .input(z.object({
      scheduleId: z.string(),
      optionId: z.string().optional(),
      email: z.string().email(),
      guests: z.object({
        adults: z.number(),
        children: z.number(),
        infants: z.number(),
      }),
    }))
    .mutation(async ({ input }) => {
      return waitlistService.join(input);
    }),
});
```

---

## TypeScript Interfaces

### Complete Type Definitions

```typescript
// ============================================================
// CORE TYPES
// ============================================================

interface Money {
  amount: number;          // In minor units (cents)
  currency: string;        // ISO 4217
}

interface GuestBreakdown {
  adults: number;
  children: number;
  infants: number;
}

// ============================================================
// PRICING MODELS
// ============================================================

type PricingModel =
  | PerPersonPricing
  | PerUnitPricing
  | FlatRatePricing
  | TieredGroupPricing
  | BasePerPersonPricing;

interface PerPersonPricing {
  type: 'per_person';
  tiers: PricingTier[];
}

interface PricingTier {
  id: string;
  name: string;
  price: Money;
  ageMin?: number;
  ageMax?: number;
  isDefault: boolean;
  sortOrder: number;
}

interface PerUnitPricing {
  type: 'per_unit';
  unitName: string;
  unitNamePlural: string;
  pricePerUnit: Money;
  maxOccupancy: number;
  minOccupancy?: number;
  baseOccupancy?: number;
  extraPersonFee?: Money;
}

interface FlatRatePricing {
  type: 'flat_rate';
  price: Money;
  maxParticipants: number;
  minParticipants?: number;
}

interface TieredGroupPricing {
  type: 'tiered_group';
  tiers: GroupTier[];
}

interface GroupTier {
  minSize: number;
  maxSize: number;
  price: Money;
}

interface BasePerPersonPricing {
  type: 'base_plus_person';
  basePrice: Money;
  includedParticipants: number;
  perPersonPrice: Money;
  maxParticipants: number;
}

// ============================================================
// CAPACITY MODELS
// ============================================================

type CapacityModel = SharedCapacity | UnitCapacity;

interface SharedCapacity {
  type: 'shared';
  totalSeats: number;
}

interface UnitCapacity {
  type: 'unit';
  totalUnits: number;
  occupancyPerUnit: number;
}

// ============================================================
// BOOKING OPTION
// ============================================================

interface BookingOption {
  id: string;
  organizationId: string;
  tourId: string;

  name: string;
  shortDescription?: string;
  fullDescription?: string;
  badge?: string;
  highlightText?: string;

  pricingModel: PricingModel;
  capacityModel: CapacityModel;
  schedulingType: 'fixed' | 'flexible';

  isDefault: boolean;
  sortOrder: number;
  status: 'active' | 'inactive';

  createdAt: Date;
  updatedAt: Date;
}

type ExperienceMode = 'join' | 'book' | 'charter';

// ============================================================
// CALCULATED OPTION (API Response)
// ============================================================

interface CalculatedOption {
  id: string;
  name: string;
  shortDescription: string;
  experienceMode: ExperienceMode;

  totalPrice: Money;
  priceBreakdown: string;

  comparison?: {
    vsShared: {
      difference: Money;
      percentMore: number;
      statement: string;
    };
  };

  badge?: 'BEST_VALUE' | 'RECOMMENDED' | 'LUXURY' | 'SAVE_MONEY';
  recommendation?: string;

  scheduling: SchedulingInfo;

  capacityFit: {
    fits: boolean;
    unitsNeeded?: number;
    fitsInOneUnit?: boolean;
    statement?: string;
  };

  available: boolean;
  urgency?: string;
}

// ============================================================
// ADD-ONS
// ============================================================

type AddOnPricing =
  | { type: 'fixed'; price: Money }
  | { type: 'per_person'; pricePerPerson: Money }
  | { type: 'per_adult'; pricePerAdult: Money }
  | { type: 'per_participant'; tiers: ParticipantTier[] }
  | { type: 'per_booking'; price: Money }
  | { type: 'per_unit'; pricePerUnit: Money };

interface ParticipantTier {
  name: string;
  price: Money;
  ageMin?: number;
  ageMax?: number;
}

interface TourAddOn {
  id: string;
  organizationId: string;
  tourId: string;

  name: string;
  description?: string;
  imageUrl?: string;

  pricingStructure: AddOnPricing;

  allowQuantity: boolean;
  maxQuantity?: number;

  hasInventory: boolean;
  inventoryPerSchedule?: number;

  applicableOptions: string[] | null;
  isRequired: boolean;
  deadlineHours?: number;

  requires?: string[];
  excludes?: string[];
  includedIn?: string[];

  sortOrder: number;
  status: 'active' | 'inactive';
}

interface CalculatedAddOn {
  id: string;
  name: string;
  description?: string;

  totalPrice: Money;
  priceExplanation: string;          // "$35 Ã— 3 guests = $105"

  isRequired: boolean;
  isIncluded: boolean;               // Auto-included in this option

  available: boolean;
  inventoryLeft?: number;
}

// ============================================================
// BOOKING
// ============================================================

interface Booking {
  id: string;
  organizationId: string;
  referenceNumber: string;

  // Guest breakdown (captured at booking)
  guestAdults: number;
  guestChildren: number;
  guestInfants: number;

  // Selected option
  bookingOptionId: string;
  optionSnapshot: {
    name: string;
    pricingModel: PricingModel;
  };

  // For unit-based bookings
  unitsBooked?: number;
  unitOccupants?: number;

  // Pricing (captured at booking)
  optionPrice: Money;
  addOnsPrice: Money;
  subtotal: Money;
  taxes: Money;
  total: Money;

  // Add-ons
  addOns: BookingAddOn[];

  // ... other booking fields
}

interface BookingAddOn {
  id: string;
  addOnId: string;
  name: string;
  quantity: number;
  unitPrice: Money;
  totalPrice: Money;
}
```

---

## UI/UX Patterns

### CRM: Managing Booking Options

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Tour: Desert Safari Experience                                [Edit Tour] â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•   â”‚
â”‚                                                                              â”‚
â”‚  BOOKING OPTIONS                                            [+ Add Option]  â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€   â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ â‹®â‹®  Shared Safari            PER PERSON    âœ“ Default     [Edit] [â‹¯] â”‚  â”‚
â”‚  â”‚     Adult: $89 Â· Child: $45 Â· Infant: Free                            â”‚  â”‚
â”‚  â”‚     Capacity: 28 seats per departure                                  â”‚  â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚  â”‚ â‹®â‹®  Private Vehicle          PER UNIT                     [Edit] [â‹¯] â”‚  â”‚
â”‚  â”‚     $299/vehicle Â· Up to 4 people                                     â”‚  â”‚
â”‚  â”‚     Inventory: 7 vehicles                                             â”‚  â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚  â”‚ â‹®â‹®  VIP Private              PER UNIT      LUXURY         [Edit] [â‹¯] â”‚  â”‚
â”‚  â”‚     $499/vehicle Â· Up to 4 people                                     â”‚  â”‚
â”‚  â”‚     Inventory: 2 luxury SUVs                                          â”‚  â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚  â”‚ â‹®â‹®  Private Minibus          PER UNIT                     [Edit] [â‹¯] â”‚  â”‚
â”‚  â”‚     $550/minibus Â· Up to 12 people                                    â”‚  â”‚
â”‚  â”‚     Inventory: 1 minibus                                              â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                              â”‚
â”‚  ADD-ONS                                                    [+ Add Add-On]  â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€   â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  BBQ Dinner              $35/person          All options   [Edit] [â‹¯] â”‚  â”‚
â”‚  â”‚  Photo Package           $25/booking         All options   [Edit] [â‹¯] â”‚  â”‚
â”‚  â”‚  Quad Bike Ride          $50/person          Shared only   [Edit] [â‹¯] â”‚  â”‚
â”‚  â”‚                          Inventory: 10                                 â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### CRM: Booking Form (Staff Perspective)

Even staff use the customer-first flow:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  New Booking                                                                 â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•   â”‚
â”‚                                                                              â”‚
â”‚  Tour                                                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  ðŸ” Desert Safari Experience                                    â–¼    â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                              â”‚
â”‚  Date                              Guests                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  ðŸ“… Dec 25, 2025        â”‚      â”‚  Adults: 2  Children: 1  Infants: 0â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                              â”‚
â”‚                              [ Check Availability ]                          â”‚
â”‚                                                                              â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€   â”‚
â”‚                                                                              â”‚
â”‚  Available Options                                                           â”‚
â”‚                                                                              â”‚
â”‚  â—‹ Shared Safari          10:00 AM    $223        8 spots left              â”‚
â”‚  â—‹ Shared Safari          2:00 PM     $223        3 spots left              â”‚
â”‚  â— Private Vehicle        Flexible    $299        â­ Best Value              â”‚
â”‚  â—‹ VIP Private            Flexible    $499                                   â”‚
â”‚                                                                              â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€   â”‚
â”‚                                                                              â”‚
â”‚  Customer                                                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  ðŸ” Search or create customer...                                      â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                              â”‚
â”‚  Add-Ons                                                                     â”‚
â”‚  â˜‘ BBQ Dinner              $105 (3 Ã— $35)                                   â”‚
â”‚  â˜ Photo Package           $25                                               â”‚
â”‚                                                                              â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€   â”‚
â”‚                                                                              â”‚
â”‚  Summary                                                                     â”‚
â”‚  Private Vehicle                               $299.00                       â”‚
â”‚  BBQ Dinner (3 guests)                         $105.00                       â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                     â”‚
â”‚  Total                                         $404.00                       â”‚
â”‚                                                                              â”‚
â”‚                                              [ Create Booking ]              â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Real-World Examples

### Example 1: Desert Safari

```typescript
const desertSafari = {
  tour: { name: "Desert Safari Experience" },

  options: [
    {
      name: "Shared Safari",
      shortDescription: "Join other travelers on a group adventure",
      pricingModel: {
        type: 'per_person',
        tiers: [
          { id: 'adult', name: 'Adult', price: { amount: 8900, currency: 'USD' } },
          { id: 'child', name: 'Child (5-12)', price: { amount: 4500, currency: 'USD' } },
          { id: 'infant', name: 'Infant (0-4)', price: { amount: 0, currency: 'USD' } },
        ]
      },
      capacityModel: { type: 'shared', totalSeats: 28 },
      schedulingType: 'fixed',
      isDefault: true,
    },
    {
      name: "Private Vehicle",
      shortDescription: "Your own 4x4 with dedicated driver",
      pricingModel: {
        type: 'per_unit',
        unitName: 'Vehicle',
        unitNamePlural: 'Vehicles',
        pricePerUnit: { amount: 29900, currency: 'USD' },
        maxOccupancy: 4,
      },
      capacityModel: { type: 'unit', totalUnits: 7, occupancyPerUnit: 4 },
      schedulingType: 'flexible',
    },
    {
      name: "VIP Private",
      shortDescription: "Luxury SUV with premium service",
      badge: "LUXURY",
      pricingModel: {
        type: 'per_unit',
        unitName: 'Luxury SUV',
        unitNamePlural: 'Luxury SUVs',
        pricePerUnit: { amount: 49900, currency: 'USD' },
        maxOccupancy: 4,
      },
      capacityModel: { type: 'unit', totalUnits: 2, occupancyPerUnit: 4 },
      schedulingType: 'flexible',
    },
    {
      name: "Private Minibus",
      shortDescription: "Perfect for larger groups",
      pricingModel: {
        type: 'per_unit',
        unitName: 'Minibus',
        unitNamePlural: 'Minibuses',
        pricePerUnit: { amount: 55000, currency: 'USD' },
        maxOccupancy: 12,
      },
      capacityModel: { type: 'unit', totalUnits: 1, occupancyPerUnit: 12 },
      schedulingType: 'flexible',
    },
  ],

  addOns: [
    {
      name: "BBQ Dinner",
      pricingStructure: { type: 'per_person', pricePerPerson: { amount: 3500, currency: 'USD' } },
      applicableOptions: null, // All
    },
    {
      name: "Professional Photo Package",
      pricingStructure: { type: 'per_booking', price: { amount: 2500, currency: 'USD' } },
      applicableOptions: null,
    },
    {
      name: "Quad Bike Ride",
      pricingStructure: { type: 'per_person', pricePerPerson: { amount: 5000, currency: 'USD' } },
      hasInventory: true,
      inventoryPerSchedule: 10,
      applicableOptions: ['shared-safari-id'], // Shared only
    },
  ],
};
```

### What Customers See

**Request:** December 25, 2 adults + 1 child

| Option | Price | Notes |
|--------|-------|-------|
| Shared Safari | $223 | 2Ã—$89 + 1Ã—$45 |
| Private Vehicle | $299 | â­ Only $76 more! |
| VIP Private | $499 | Luxury |

**Request:** December 25, 8 adults

| Option | Price | Notes |
|--------|-------|-------|
| Shared Safari | $712 | 8Ã—$89 |
| 2 Private Vehicles | $598 | â­ Save $114! |
| Private Minibus | $550 | Best for groups |

---

## Implementation Plan

### Phase 1: Database & Schema

| Task | Description |
|------|-------------|
| Create `booking_options` table | Drizzle schema with JSONB for pricing/capacity |
| Create `tour_add_ons` table | Flexible pricing structure |
| Create `schedule_option_availability` | Per-schedule tracking |
| Create `waitlist_entries` | Waitlist support |
| Update `bookings` table | Add option reference, guest breakdown |
| Generate migrations | Test with seed data |

### Phase 2: Services

| Task | Description |
|------|-------------|
| `BookingOptionService` | CRUD for options |
| `AvailabilityService` | **Core: Check availability with calculated prices** |
| `PricingCalculatorService` | Calculate all pricing models |
| `RecommendationEngine` | Generate smart recommendations |
| `AddOnService` | Manage add-ons with calculations |
| `WaitlistService` | Join/notify/convert waitlist |

### Phase 3: API

| Task | Description |
|------|-------------|
| `availability.checkAvailability` | Main query endpoint |
| `availability.getAddOns` | Get add-ons for option |
| `availability.joinWaitlist` | Waitlist endpoint |
| `bookingOption.*` | CRUD endpoints |
| `tourAddOn.*` | CRUD endpoints |

### Phase 4: CRM UI

| Task | Description |
|------|-------------|
| Options panel in tour detail | List/create/edit options |
| Option editor modal | Configure pricing model |
| Add-ons panel | Manage add-ons |
| Update booking form | Customer-first flow |
| Update booking detail | Show option, breakdown |

### Phase 5: Web Booking (Phase 8)

| Task | Description |
|------|-------------|
| Date/guest selector | Step 1 of flow |
| Options display | Step 2 with calculations |
| Time slot selector | For fixed schedules |
| Add-on selector | Step 4 |
| Checkout integration | Full flow |

---

## Key Principles Summary

1. **Customer inputs first** â€” Date and guests before showing options
2. **Calculate, don't configure** â€” Prices computed from guest breakdown
3. **Filter intelligently** â€” Hide options that don't fit
4. **Recommend smartly** â€” Surface best value, not just cheapest
5. **Compare clearly** â€” Show difference vs shared baseline
6. **Snapshot at booking** â€” Capture exact prices, immune to changes

---

*Document maintained by Claude. Customer-first flow designed December 2025.*
